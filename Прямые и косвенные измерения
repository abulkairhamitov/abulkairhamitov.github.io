from sympy import *

#Коэффициенты
tpn = 2.78
vpn = 0.64
bpn = 0.51

#Прямые или косвенные
choice                  = int(input('Для прямых измерений напишите 0, косвенные - 1 '))

if(choice == 0):
    #Количество измерений
    quantity_meterages  = int(input('Введите количество измерений '))
    meterage            = [i for i in range(quantity_meterages)]

    #Ввод результатов измирений
    for i in range(quantity_meterages):
        meterage[i] = float(input('Введите' ' результат измерения ' + str(i+1) + ' '))

    #Приборная погрешность
    instrument_error = float(input('Введите приборную погрешность '))
    print('\n')

    #В порядке возрастания
    meterage_increase   = sorted(meterage)

    #Среднее арифмитическое результатов измерений
    average             = sum(meterage)/quantity_meterages

    #Размах
    range               = max(meterage) - min(meterage)

    #Для проверки на промахи
    V                   = vpn*range

    #Проверка на наличие промохов
    print('Проверка на промахи')
    count               = 0
    i                   = 0
    while i < quantity_meterages:
        print(str(meterage_increase[i]) + ' - ' + str(meterage_increase[i-1]) + ' = ' + str(meterage_increase[i] - meterage_increase[i-1]))
        if meterage[i]-meterage[i-1] > V:
            count = 1
        i += 1
    print('Размах = ' + str(range))
    print('V = ' + str(V))

    if count == 1:
        print('Промахи есть')
    else:
        print('Промахов нет')
    print('\n')

    # Считаем СКО и СКОС
    difference_meterage__average___square = []
    i = 0
    while i < quantity_meterages - 1:
        difference_meterage__average___square.append((meterage[i] - average)**2)
        i += 1
    SKO                 = ((sum(difference_meterage__average___square))/(quantity_meterages-1))**0.5
    SKOS                = ((sum(difference_meterage__average___square))/((quantity_meterages-1)*quantity_meterages))**0.5

    #Cчитаем случайную погрешность
    random_error        = tpn*SKOS

    #Для проверки по размаху выборки
    range_error         = bpn*range

    #Полная погрешность
    complete_error      = (random_error**2 + instrument_error**2)**0.5

    #Относительная погрешность
    relative_error      = (complete_error/average)*100

    print('В порядке возрастания '      + str(meterage_increase))

    print('\n')

    print('Среднее значение равно: '    + str(average))

    print('СКО                       = ' + str(SKO))
    print('СКОС                      = ' + str(SKOS))
    print('Случайная погрешность     = ' + str(random_error))
    print('По размаху выборки        = ' + str(range_error))
    print('Полная погрешность        = ' + str(complete_error))
    print('Относительная погрешность = ' + str(relative_error))
    print('Истинное значение         = ' + str(average) + '+-' + str(complete_error))
else:
    arguments = int(input('Введите количество аргументов функции '))

    # Среднее арифмитическое результатов (инициализация списка)
    average = []

    # Инициализация списка полной погрешности
    complete_error = []

    for a in range(arguments):
        # Количество измерений
        quantity_meterages = int(input('Введите количество измерений '))
        meterage = []

        # Ввод результатов измирений
        i = 0
        while i < quantity_meterages:
            meterage.append(float(input('Введите' ' результат измерения ' + str(i + 1) + ' ')))
            i += 1

        # Приборная погрешность
        instrument_error = float(input('Введите приборную погрешность '))
        print('\n')

        # В порядке возрастания
        meterage_increase = sorted(meterage)

        # Среднее арифмитическое результатов измерений
        average.append(sum(meterage) / quantity_meterages)

        # Размах
        range = max(meterage) - min(meterage)

        # Для проверки на промахи
        V = vpn * range

        # Проверка на наличие промохов
        print('Проверка на промахи')
        count = 0
        i = 1
        while i < quantity_meterages:
            print(str(meterage_increase[i]) + ' - ' + str(meterage_increase[i - 1]) + ' = ' + str(
                meterage_increase[i] - meterage_increase[i - 1]))
            if meterage[i] - meterage[i - 1] > V:
                count = 1
            i += 1
        print('Размах = ' + str(range))
        print('V = ' + str(V))

        if count == 1:
            print('Промахи есть')
        else:
            print('Промахов нет')
        print('\n')

        # Считаем СКО и СКОС
        difference_meterage__average___square = []
        i = 0
        while i < quantity_meterages - 1:
            difference_meterage__average___square.append((meterage[i] - average[a]) ** 2)
            i += 1
        SKO             = ((sum(difference_meterage__average___square)) / (quantity_meterages - 1)) ** 0.5
        SKOS            = ((sum(difference_meterage__average___square)) / ((quantity_meterages - 1) * quantity_meterages)) ** 0.5

        # Cчитаем случайную погрешность
        random_error    = tpn * SKOS

        # Для проверки по размаху выборки
        range_error     = bpn * range

        # Полная погрешность
        complete_error.append((random_error ** 2 + instrument_error ** 2) ** 0.5)

        # Относительная погрешность
        relative_error  = (complete_error[a] / average[a]) * 100

        #Очистка результатов измирений
        meterage.clear()

        print('В порядке возрастания ' + str(meterage_increase))

        print('\n')

        print('Среднее значение равно: ' + str(average[a]))

        print('СКО                       = ' + str(SKO))
        print('СКОС                      = ' + str(SKOS))
        print('Случайная погрешность     = ' + str(random_error))
        print('По размаху выборки        = ' + str(range_error))
        print('Полная погрешность        = ' + str(complete_error[a]))
        print('Относительная погрешность = ' + str(relative_error))
        print('Истинное значение         = ' + str(average[a]) + '+-' + str(complete_error[a]))

    #Здесь написать требуюмую функцию
    m, V0, M = symbols('m V0 M')
    function = (m*V0)/(m+(1/3*M))
    diff1_function = diff(function, m)
    diff2_function = diff(function, V0)
    diff3_function = diff(function, M)

    #Вывод самой функции и его среднего значения
    print(str(function))
    m = average[0]
    V0 = average[1]
    M = average[2]
    average_function = (m * V0) / (m + (1 / 3 * M))
    print('Среднее значение функции равно = ' + str(average_function))
    print('\n')

    #
    print('1-ая частная производная = ' + str(diff1_function))
    print('2-ая частная производная = ' + str(diff2_function))
    print('3-ая частная производная = ' + str(diff3_function))
    ax                      = float(input('Введите результат 1 производной '))
    ay                      = float(input('Введите результат 2 производной '))
    az                      = float(input('Введите результат 3 производной '))
    complete_error_function = ((ax*complete_error[0])**2 + (ay*complete_error[1])**2 + (az*complete_error[2]**2))**0.5
    print('Истинное значени функции = ' + str(average_function) + '+-' + str(complete_error_function))


